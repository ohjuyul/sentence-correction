import sentencepiece as spm

def check_unk_ratio(model_file, corpus_file, sample_size=None):
    sp = spm.SentencePieceProcessor(model_file=model_file)
    total_tokens = 0
    unk_tokens = 0

    with open(corpus_file, "r", encoding="utf-8") as f:
        for i, line in enumerate(f):
            if sample_size and i >= sample_size:
                break
            line = line.strip()
            if not line:
                continue
            ids = sp.encode(line, out_type=int)
            total_tokens += len(ids)
            unk_tokens += sum(1 for tid in ids if tid == sp.unk_id())

    ratio = (unk_tokens / total_tokens) * 100 if total_tokens else 0
    print(f"UNK Tokens: {unk_tokens} / {total_tokens} ({ratio:.4f}%)")

# 사용 예시
check_unk_ratio("decoder_spm_bpe24k.model", "corpus_mixed.txt", sample_size=50000)
